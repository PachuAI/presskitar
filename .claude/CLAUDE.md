# üîß Reglas del Proyecto - presskit.ar

**Versi√≥n**: 1.0
**Fecha**: 2025-09-30

---

## üìñ Documentaci√≥n Obligatoria

**Antes de empezar, leer:**
@docs/manual-uso-agentes-comandos.md

Este manual contiene el workflow oficial con todos los comandos y casos de uso.

---

## üåê Idioma del Proyecto

**Idioma principal**: Espa√±ol

### Reglas de Idioma

**‚úÖ Usar ESPA√ëOL en:**
- C√≥digo de aplicaci√≥n (variables, funciones, comentarios)
- Nombres de variables de negocio (`artistName`, `nombreArtista`, `perfilPublicado`)
- Comentarios en c√≥digo
- Mensajes de error al usuario
- Documentaci√≥n de features y funcionalidades
- Commits (espa√±ol o ingl√©s, preferentemente espa√±ol)

**‚úÖ Usar INGL√âS en:**
- T√©rminos t√©cnicos IT est√°ndar (`useState`, `useEffect`, `async`, `await`)
- Nombres de componentes React (`ProfileEditor`, `AudioUploader`)
- Nombres de tipos TypeScript (`ProfileData`, `ThemeSettings`)
- Nombres de archivos de c√≥digo (`profile-editor.tsx`, `use-auth.ts`)
- Librer√≠as y frameworks (Next.js, Supabase, Zod, etc.)
- Documentaci√≥n t√©cnica cuando sea m√°s claro (endpoints: `GET /api/perfil`)

**Ejemplo de c√≥digo:**
```typescript
// ‚úÖ CORRECTO: Mezcla natural de espa√±ol e ingl√©s t√©cnico
async function obtenerPerfilDeArtista(artistName: string): Promise<ProfileData> {
  const { data: perfil, error } = await supabase
    .from('profiles')
    .select('*')
    .eq('artist_name', artistName)
    .single()

  if (error) {
    throw new Error('No se pudo obtener el perfil del artista')
  }

  return perfil
}

// ‚ùå INCORRECTO: Todo en ingl√©s sin raz√≥n t√©cnica
async function getArtistProfile(artistName: string): Promise<ProfileData> {
  const { data: profile, error } = await supabase
    .from('profiles')
    .select('*')
    .eq('artist_name', artistName)
    .single()

  if (error) {
    throw new Error('Could not fetch artist profile')
  }

  return profile
}
```

---

## üõ†Ô∏è Stack T√©cnico

### Framework y Librer√≠as
- **Next.js 14** (App Router)
- **React 18** (Server Components + Client Components)
- **TypeScript** (strict mode)
- **Supabase**:
  - PostgreSQL (database)
  - Auth (email + Google OAuth)
  - Storage (archivos de usuarios)

### Estado y Validaci√≥n
- **Zod** - Validaci√≥n de schemas (OBLIGATORIO para todas las APIs)
- **Zustand + Immer** - Estado global del editor
- **React Hook Form** - Formularios

### UI y Estilos
- **shadcn/ui** - Componentes base
- **Tailwind CSS** - Estilos
- **Lucide React** - Iconos

### Testing
- **Vitest** - Unit tests
- **Playwright** - E2E tests
- **Testing Library** - React component tests

### Infraestructura
- **Vercel** - Hosting y preview deploys
- **Vercel KV** - Rate limiting
- **Sharp** - Procesamiento de im√°genes (blur placeholders)

---

## üìù Convenciones de C√≥digo

### Nombres de Variables
- **Variables de negocio**: Espa√±ol (`artistName`, `nombreArtista`, `perfilPublicado`)
- **Componentes React**: Ingl√©s (`ProfileEditor`, `AudioUploader`)
- **Funciones de utilidad**: Ingl√©s (`sanitizeHtml`, `generateBlurHash`)
- **Endpoints API**: Espa√±ol (`/api/perfil`, `/api/archivos`)

### Estructura de Archivos
```
app/
‚îú‚îÄ‚îÄ (auth)/           # Rutas de autenticaci√≥n
‚îú‚îÄ‚îÄ (public)/         # Rutas p√∫blicas (perfiles)
‚îú‚îÄ‚îÄ (dashboard)/      # Rutas protegidas (editor)
‚îî‚îÄ‚îÄ api/              # API routes

components/
‚îú‚îÄ‚îÄ ui/               # shadcn/ui base components
‚îú‚îÄ‚îÄ editor/           # Componentes del editor
‚îî‚îÄ‚îÄ public/           # Componentes p√∫blicos (perfil view)

lib/
‚îú‚îÄ‚îÄ validations/      # Schemas Zod
‚îú‚îÄ‚îÄ supabase/         # Clients y helpers
‚îî‚îÄ‚îÄ utils/            # Utilidades

types/                # TypeScript types globales
```

### Server Actions y API Routes
- **Siempre** usar `"use server"` en server actions
- **Siempre** validar con Zod antes de procesar `request.json()`
- **Nunca** exponer `SUPABASE_SERVICE_ROLE_KEY` en cliente
- **Nunca** confiar en datos del cliente sin validaci√≥n

```typescript
// ‚úÖ CORRECTO
const body = await request.json()
const result = miSchema.safeParse(body)
if (!result.success) return NextResponse.json({ error: result.error }, { status: 400 })
const { campo1, campo2 } = result.data  // Usar result.data

// ‚ùå INCORRECTO
const body = await request.json()
const { campo1 } = body  // NO usar body directamente
```

---

## üîê Seguridad

### Variables de Entorno
- `NEXT_PUBLIC_*` ‚Üí Expuestas al cliente (URLs p√∫blicas)
- `SUPABASE_SERVICE_ROLE_KEY` ‚Üí **NUNCA** en cliente, solo en server actions/API routes
- `GOOGLE_CLIENT_SECRET` ‚Üí Solo server-side

### Row Level Security (RLS)
- **SIEMPRE** usar RLS en Supabase
- **Nunca** confiar en checks del cliente
- Pol√≠ticas definidas en `supabase/migrations/`

### Sanitizaci√≥n
- **DOMPurify** para HTML user-generated (bio, tagline)
- **Zod** para validar tipos y formatos
- **Sharp** para procesar im√°genes (prevenir exploits)

---

## üéØ Gesti√≥n de Fases - Workflow Oficial

### Comandos Principales

#### Inicio de Sesi√≥n
```
/arranca
```
‚Üí Lee estado actual, memoria, √∫ltimos commits

#### Gesti√≥n de Fases
```
/fase          # Ver estado actual
/fase start    # Iniciar fase (genera breakdown + todos)
/fase complete # Completar fase (verifica checkboxes)
/fase list     # Ver todas las fases
```

#### Commits Durante Desarrollo
```
/commit              # Commit autom√°tico con mensaje generado
/commit "mensaje"    # Commit con mensaje custom
/commit --suggest    # Solo sugerir mensaje
```

#### Fin de Sesi√≥n
```
/recap         # Documentar sesi√≥n (SIEMPRE antes de /clear)
```

### Reglas del Workflow

#### ‚úÖ HACER

1. **SIEMPRE** ejecutar `/arranca` al inicio de sesi√≥n
2. **SIEMPRE** ejecutar `/recap` antes de `/clear`
3. **SIEMPRE** leer `docs/fases/FASE_N_breakdown.md` para ver subtareas
4. **SIEMPRE** actualizar checkboxes al completar subtareas
5. **SIEMPRE** usar `/commit` despu√©s de completar cada subtarea o grupo l√≥gico
6. **SIEMPRE** seguir el plan de implementaci√≥n (`docs/plan-implementacion.md`)

#### ‚ùå NO HACER

1. **NO** ejecutar `/fase start` si la fase ya est√° iniciada
2. **NO** ejecutar `/fase complete` con checkboxes pendientes
3. **NO** modificar `docs/plan-implementacion.md` sin consenso
4. **NO** saltear fases sin completarlas (solo para debugging)
5. **NO** hacer `/clear` sin antes hacer `/recap`
6. **NO** pushear c√≥digo sin tests (si la fase tiene üß™)

---

## üß™ Tests

### Cu√°ndo Escribir Tests
- **Obligatorio**: Fases marcadas con üß™ en el plan
- **Recomendado**: Funciones cr√≠ticas (validaciones, autenticaci√≥n, uploads)
- **Opcional**: Componentes simples de UI

### Tipos de Tests
```typescript
// Unit Tests (Vitest)
// lib/validations/__tests__/perfil.test.ts
describe('perfilSchema', () => {
  it('valida perfil correcto')
  it('rechaza artist_name inv√°lido')
})

// Component Tests (Testing Library)
// components/editor/__tests__/PanelCustomizacion.test.tsx
describe('PanelCustomizacion', () => {
  it('actualiza backgroundColor en store')
})

// E2E Tests (Playwright)
// e2e/auth.spec.ts
test('usuario puede registrarse con email', async ({ page }) => {
  // ...
})
```

### Ejecuci√≥n
```bash
npm test              # Unit + component tests
npm run test:e2e      # Playwright E2E
npm run test:hito-1   # Tests de hito completo
```

---

## üì¶ Commits

### Comando `/commit`

**Usar `/commit` para todos los commits durante desarrollo:**

```bash
/commit              # Commit autom√°tico con mensaje generado
/commit "mensaje"    # Commit con mensaje custom
/commit --suggest    # Solo sugerir mensaje (no commitea)
```

**Qu√© hace `/commit`:**
- Analiza cambios con git status y git diff
- Lee estado actual de la fase
- Genera mensaje sem√°ntico siguiendo conventional commits
- Commitea autom√°ticamente

**Ver detalles**: `.claude/commands/commit.md`

### Formato de Mensajes (Conventional Commits)

```bash
# Subtareas de fases
feat(fase-N): descripci√≥n breve de subtarea
fix(fase-N): corregir bug en componente X
test(fase-N): agregar tests de validaci√≥n

# Completar fase
feat: completar Fase N - Nombre de la Fase

# Completar hito
feat: completar Hito N - Nombre del Hito

# Documentaci√≥n
docs: actualizar manual con flujo de commits
```

### Frecuencia
- **Cada subtarea** o grupo l√≥gico de subtareas ‚Üí `/commit`
- **Al completar fase** (despu√©s de `/fase complete`) ‚Üí `/commit`
- **Antes de `/recap`** (para que aparezca en git log)

---

## üöÄ Deploy y Checkpoints

### Preview Deploys
- Autom√°tico en cada push a Vercel
- URL: `presskit-ar-[branch].vercel.app`

### Checkpoint de Hito
Al completar todas las fases de un hito:

1. ‚úÖ Ejecutar tests completos del hito
2. ‚úÖ Deploy a preview
3. ‚úÖ Smoke tests manuales
4. ‚úÖ Actualizar `docs/estado-proyecto.json`:
   ```json
   { "hitos_completados": [1] }
   ```
5. ‚úÖ Commit y tag:
   ```bash
   git commit -m "feat: completar Hito 1 - Database y Autenticaci√≥n"
   git tag v0.1-hito-1
   git push --tags
   ```

---

## üé® UI/UX

### Componentes shadcn/ui
- Usar componentes de `components/ui/` (generados por shadcn)
- NO modificar componentes base, extenderlos si necesario
- Customizaci√≥n de tema en `tailwind.config.ts`

### Responsive
- Mobile-first approach
- Breakpoints: `sm:` (640px), `md:` (768px), `lg:` (1024px)
- Editor: Desktop only (min-width: 1024px)
- Perfiles p√∫blicos: Fully responsive

### Accesibilidad
- Usar componentes sem√°nticos de shadcn/ui (ya tienen ARIA)
- Labels en todos los inputs
- Alt text en im√°genes
- Contraste adecuado (WCAG AA)

---

## üìö Referencias R√°pidas

| Documento | Prop√≥sito |
|-----------|-----------|
| `docs/manual-uso-agentes-comandos.md` | Workflow oficial completo |
| `docs/plan-implementacion.md` | Plan de 26 fases |
| `docs/estado-proyecto.json` | Estado t√©cnico actual |
| `memoria/estado.md` | Estado narrativo |
| `memoria/proximos-pasos.md` | Qu√© hacer ahora |
| `docs/PRD.md` | Product Requirements |
| `docs/arquitectura.md` | Decisiones t√©cnicas |

---

## üîÑ Ciclo T√≠pico de Trabajo

```
1. /arranca
   ‚Üí "Est√°s en Fase 5, continuar subtarea 4"

2. [Leo docs/fases/FASE_5_breakdown.md]
   ‚Üí Veo qu√© falta

3. [Implemento subtarea]
   ‚Üí Escribo c√≥digo + tests

4. [Actualizo checkbox en breakdown.md]
   ‚Üí - [x] 4. Subtarea completada

5. /commit
   ‚Üí "feat(fase-5): implementar subtarea 4"

6. [Repito 3-5 hasta terminar fase]

7. /fase complete
   ‚Üí "‚úÖ Fase 5 completada"

8. /commit
   ‚Üí "feat: completar Fase 5 - API Gesti√≥n"

9. /recap
   ‚Üí "‚úÖ Sesi√≥n documentada"

10. /clear
```

---

**√öltima actualizaci√≥n**: 2025-09-30
**Mantenido por**: Claude Code + Usuario

**Si ten√©s dudas, le√© primero el manual:**
@docs/manual-uso-agentes-comandos.md
